import{j as e}from"./jsx-runtime.DCqPeNwG.js";import{r as n}from"./index.66AI1_x2.js";import{F as q,s as F}from"./index.BIoUD3Jb.js";import{g as L,S as J}from"./SchemaDetailsPanel.BRT9DAAU.js";import{b as O,a as W}from"./ChevronUpIcon.BKjCCL5T.js";import{b as X}from"./ServerIcon.LgKSWxXk.js";import{F as I}from"./XMarkIcon.Dg371sj5.js";import{b as Y}from"./url-builder.CDvnl6kO.js";import{g as Z}from"./utils.3o3n54R3.js";import{F as ee}from"./DocumentTextIcon.CYz0cPkW.js";import"./_commonjsHelpers.Cpj98o6Y.js";/* empty css                       */import"./UserIcon.hQiBrlw_.js";import"./ServerIcon.CZuN-42e.js";import"./index.DXj_uSRK.js";import"./index.dom.MoK_LCF9.js";import"./JSONSchemaViewer.DB8igcoM.js";import"./AvroSchemaViewer.CV_-5E2k.js";import"./index.DvWqczMf.js";import"./index.BKRqKadn.js";import"./index.pGnXyoOV.js";import"./index.BXXhdAF5.js";import"./EnvelopeIcon.CURY145Q.js";function te({searchQuery:r,onSearchChange:c,selectedType:i,onTypeChange:g,selectedSchemaType:d,onSchemaTypeChange:x,schemaTypes:u,latestMessages:f,filtersExpanded:a,onToggleExpanded:j,searchInputRef:y,isMounted:N}){const b=[r,i!=="all",d!=="all"].filter(Boolean).length;return e.jsxs("div",{className:"flex-shrink-0 border-b border-gray-200 bg-gray-50",children:[e.jsxs("button",{onClick:j,className:"w-full flex items-center justify-between p-3 hover:bg-gray-100 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(q,{className:"h-4 w-4 text-gray-600"}),e.jsx("span",{className:"text-xs font-semibold text-gray-900",children:"Filters"}),b>0&&e.jsx("span",{className:"inline-flex items-center rounded-full bg-primary px-2 py-0.5 text-xs font-medium text-white",children:b})]}),a?e.jsx(O,{className:"h-4 w-4 text-gray-600"}):e.jsx(W,{className:"h-4 w-4 text-gray-600"})]}),N&&a&&e.jsxs("div",{className:"p-3 pt-0",children:[e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{htmlFor:"search",className:"block text-xs font-medium text-gray-700 mb-1.5",children:"Search"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"pointer-events-none absolute inset-y-0 left-0 flex items-center pl-2.5",children:e.jsx(X,{className:"h-4 w-4 text-gray-400"})}),e.jsx("input",{ref:y,type:"text",id:"search",placeholder:"Search schemas...",value:r,onChange:l=>c(l.target.value),className:"w-full rounded-md border-gray-300 shadow-sm focus:border-primary focus:ring-primary text-xs pl-8 pr-8 py-1.5 border"}),r&&e.jsx("button",{onClick:()=>c(""),className:"absolute inset-y-0 right-0 flex items-center pr-2.5",children:e.jsx(I,{className:"h-4 w-4 text-gray-400 hover:text-gray-600"})})]})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{htmlFor:"messageType",className:"block text-xs font-medium text-gray-700 mb-1.5",children:"Message Type"}),e.jsxs("select",{id:"messageType",value:i,onChange:l=>g(l.target.value),className:"w-full rounded-md border-gray-300 shadow-sm focus:border-primary focus:ring-primary text-xs px-2.5 py-1.5 border",children:[e.jsxs("option",{value:"all",children:["All (",f.length,")"]}),e.jsxs("option",{value:"events",children:["Events (",f.filter(l=>l.collection==="events").length,")"]}),e.jsxs("option",{value:"commands",children:["Commands (",f.filter(l=>l.collection==="commands").length,")"]}),e.jsxs("option",{value:"queries",children:["Queries (",f.filter(l=>l.collection==="queries").length,")"]}),e.jsxs("option",{value:"services",children:["Services (",f.filter(l=>l.collection==="services").length,")"]})]})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{htmlFor:"schemaType",className:"block text-xs font-medium text-gray-700 mb-1.5",children:"Schema Format"}),e.jsxs("select",{id:"schemaType",value:d,onChange:l=>x(l.target.value),className:"w-full rounded-md border-gray-300 shadow-sm focus:border-primary focus:ring-primary text-xs px-2.5 py-1.5 border",children:[e.jsx("option",{value:"all",children:"All Formats"}),u.map(l=>e.jsxs("option",{value:l,children:[L(l)," (",f.filter(S=>S.schemaExtension?.toLowerCase()===l).length,")"]},l))]})]}),b>0&&e.jsx("div",{className:"pt-2 border-t border-gray-200",children:e.jsxs("div",{className:"flex flex-wrap items-center gap-1.5",children:[r&&e.jsxs("span",{className:"inline-flex items-center gap-1 px-1.5 py-0.5 text-xs bg-blue-100 text-blue-800 rounded",children:[r.substring(0,15),r.length>15?"...":"",e.jsx("button",{onClick:()=>c(""),children:e.jsx(I,{className:"h-3 w-3"})})]}),i!=="all"&&e.jsxs("span",{className:"inline-flex items-center gap-1 px-1.5 py-0.5 text-xs bg-blue-100 text-blue-800 rounded",children:[i,e.jsx("button",{onClick:()=>g("all"),children:e.jsx(I,{className:"h-3 w-3"})})]}),d!=="all"&&e.jsxs("span",{className:"inline-flex items-center gap-1 px-1.5 py-0.5 text-xs bg-blue-100 text-blue-800 rounded",children:[L(d),e.jsx("button",{onClick:()=>x("all"),children:e.jsx(I,{className:"h-3 w-3"})})]}),e.jsx("button",{onClick:()=>{c(""),g("all"),x("all")},className:"text-xs text-gray-600 hover:text-gray-900 underline",children:"Clear"})]})})]})]})}function se({message:r,isSelected:c,versions:i,onClick:g,itemRef:d}){const{color:x,Icon:u}=Z(r.collection),f=i.length>1;return e.jsx("button",{ref:d,onClick:g,className:`w-full text-left p-4 hover:bg-gray-50 transition-colors ${c?`bg-${x}-50 border-l-4 border-${x}-500`:"border-l-4 border-transparent"}`,children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(u,{className:`h-5 w-5 mt-0.5 flex-shrink-0 ${c?`text-${x}-600`:`text-${x}-500`}`}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2 mb-1.5",children:[e.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[e.jsx("h3",{className:`text-sm font-semibold truncate ${c?`text-${x}-900`:"text-gray-900"}`,children:r.data.name}),e.jsxs("span",{className:"text-xs text-gray-500 flex-shrink-0",children:["v",r.data.version]})]}),e.jsxs("div",{className:"flex items-center gap-1 flex-shrink-0",children:[e.jsx("span",{className:"inline-flex items-center gap-1 rounded-full bg-gray-100 px-1.5 py-0.5 text-xs font-medium text-gray-800",children:(()=>{const a=r.schemaExtension?.toLowerCase();if(a==="openapi"||a==="asyncapi"||a==="graphql"||a==="avro"||a==="json"||a==="proto"){const y=Y(`/icons/${a==="json"?"json-schema":a}.svg`,!0);return e.jsxs(e.Fragment,{children:[e.jsx("img",{src:y,alt:`${a} icon`,className:"h-3 w-3"}),L(r.schemaExtension)]})}return L(r.schemaExtension)})()}),f&&e.jsxs("span",{className:"inline-flex items-center rounded-full bg-blue-100 px-1 py-0.5 text-xs font-medium text-blue-700",children:[i.length," versions"]})]})]}),r.data.summary&&e.jsx("p",{className:"text-xs text-gray-600 line-clamp-2",children:r.data.summary})]})]})})}function re({currentPage:r,totalPages:c,onPageChange:i}){return c<=1?null:e.jsx("div",{className:"flex-shrink-0 border-t border-gray-200 p-3 bg-gray-50",children:e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsx("button",{onClick:()=>i(Math.max(1,r-1)),disabled:r===1,className:"px-3 py-1.5 text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:"Previous"}),e.jsxs("span",{className:"text-gray-600",children:["Page ",r," of ",c]}),e.jsx("button",{onClick:()=>i(Math.min(c,r+1)),disabled:r===c,className:"px-3 py-1.5 text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:"Next"})]})})}function Ce({schemas:r,apiAccessEnabled:c=!1}){const[i,g]=n.useState(()=>{if(typeof window<"u"){const t=localStorage.getItem("schemaRegistrySearchQuery");return t!==null?t:""}return""}),[d,x]=n.useState(()=>{if(typeof window<"u"){const t=localStorage.getItem("schemaRegistrySelectedType");return t!==null?t:"all"}return"all"}),[u,f]=n.useState(()=>{if(typeof window<"u"){const t=localStorage.getItem("schemaRegistrySelectedSchemaType");return t!==null?t:"all"}return"all"}),[a,j]=n.useState(null),[y,N]=n.useState(null),[b,l]=n.useState(1),[S,B]=n.useState(()=>{if(typeof window<"u"){const t=localStorage.getItem("schemaRegistryFiltersExpanded");return t!==null?t==="true":!0}return!0}),[D,G]=n.useState(!1),P=n.useRef(null),V=n.useRef(null),_=50;n.useEffect(()=>{G(!0)},[]);const A=t=>{if(typeof window>"u")return;const s=new URLSearchParams;s.set("id",t.data.id),s.set("version",t.data.version),s.set("collection",t.collection),t.collection==="services"&&s.set("specType",t.specType||"unknown");const o=`${window.location.pathname}?${s.toString()}`;window.history.pushState({},"",o)},w=n.useMemo(()=>{const t=new Map;return r.forEach(s=>{const o=s.collection==="services"?`${s.data.id}__${s.specType||"unknown"}`:s.data.id,m=t.get(o)||[];t.set(o,[...m,s])}),t.forEach((s,o)=>{s.sort((m,k)=>{const v=m.data.version,h=k.data.version,M=F.valid(F.coerce(v)),$=F.valid(F.coerce(h));if(M&&$)return F.rcompare(M,$);const R=parseFloat(v),T=parseFloat(h);return!isNaN(R)&&!isNaN(T)?T-R:h.localeCompare(v)}),t.set(o,s)}),t},[r]),C=n.useMemo(()=>Array.from(w.values()).map(t=>t[0]),[w]),Q=n.useMemo(()=>{const t=new Set;return C.forEach(s=>{s.schemaExtension&&t.add(s.schemaExtension.toLowerCase())}),Array.from(t).sort()},[C]),E=n.useMemo(()=>{let t=[...C];if(d!=="all"&&(t=t.filter(s=>s.collection===d)),u!=="all"&&(t=t.filter(s=>s.schemaExtension?.toLowerCase()===u)),i){const s=i.toLowerCase();t=t.filter(o=>o.data.name?.toLowerCase().includes(s)||o.data.summary?.toLowerCase().includes(s)||o.data.id?.toLowerCase().includes(s))}return t.sort((s,o)=>{const m=s.data.name?.toLowerCase()||"",k=o.data.name?.toLowerCase()||"";return m.localeCompare(k)}),t},[C,i,d,u]),z=Math.ceil(E.length/_),K=n.useMemo(()=>{const t=(b-1)*_;return E.slice(t,t+_)},[E,b]);n.useEffect(()=>{l(1)},[i,d,u]),n.useEffect(()=>{if(typeof window>"u")return;const t=new URLSearchParams(window.location.search),s=t.get("id"),o=t.get("version"),m=t.get("collection"),k=t.get("specType");if(s&&o){const v=r.find(h=>{const M=h.data.id===s,$=h.data.version===o,R=!m||h.collection===m;if(h.collection==="services"){const T=!k||h.specType===k;return M&&$&&R&&T}return M&&$&&R});v&&(j(v),N(v.data.version),setTimeout(()=>{V.current&&V.current.scrollIntoView({behavior:"smooth",block:"center"})},100))}},[r]),n.useEffect(()=>{if(typeof window>"u")return;const s=new URLSearchParams(window.location.search).has("id");if(E.length>0&&!a&&!s){const o=E[0];j(o),N(o.data.version)}},[E,a]);const p=n.useMemo(()=>{if(!a)return null;const t=a.collection==="services"?`${a.data.id}__${a.specType||"unknown"}`:a.data.id,s=w.get(t);return s?y&&s.find(m=>m.data.version===y)||s[0]:a},[a,y,w]);n.useEffect(()=>{typeof window<"u"&&localStorage.setItem("schemaRegistryFiltersExpanded",S.toString())},[S]),n.useEffect(()=>{typeof window<"u"&&localStorage.setItem("schemaRegistrySearchQuery",i)},[i]),n.useEffect(()=>{typeof window<"u"&&localStorage.setItem("schemaRegistrySelectedType",d)},[d]),n.useEffect(()=>{typeof window<"u"&&localStorage.setItem("schemaRegistrySelectedSchemaType",u)},[u]),n.useEffect(()=>{const t=s=>{(s.metaKey||s.ctrlKey)&&s.key==="k"&&(s.preventDefault(),P.current?.focus())};return window.addEventListener("keydown",t),()=>window.removeEventListener("keydown",t)},[]);const U=n.useMemo(()=>{if(!p)return[];const t=p.collection==="services"?`${p.data.id}__${p.specType||"unknown"}`:p.data.id;return w.get(t)||[p]},[p,w]),H=t=>{N(t);const s=U.find(o=>o.data.version===t);s&&A(s)};return e.jsx("div",{className:"h-full flex flex-col overflow-hidden",children:e.jsxs("div",{className:"flex-1 flex gap-4 overflow-hidden",children:[e.jsxs("div",{className:"w-1/3 flex flex-col bg-white border border-gray-200 rounded-lg overflow-hidden",children:[e.jsx(te,{searchQuery:i,onSearchChange:g,selectedType:d,onTypeChange:x,selectedSchemaType:u,onSchemaTypeChange:f,schemaTypes:Q,latestMessages:C,filtersExpanded:S,onToggleExpanded:()=>B(!S),searchInputRef:P,isMounted:D}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:K.length>0?e.jsx("div",{className:"divide-y divide-gray-200",children:K.map(t=>{const s=t.collection==="services"?a?.data.id===t.data.id&&a?.specType===t.specType:a?.data.id===t.data.id,o=t.collection==="services"?`${t.data.id}__${t.specType||"unknown"}`:t.data.id,m=w.get(o)||[t];return e.jsx(se,{message:t,isSelected:s,versions:m,onClick:()=>{j(t),N(t.data.version),A(t)},itemRef:s?V:void 0},o)})}):e.jsxs("div",{className:"flex flex-col items-center justify-center h-full p-8 text-center",children:[e.jsx(q,{className:"h-12 w-12 text-gray-400 mb-3"}),e.jsx("h3",{className:"text-sm font-semibold text-gray-900 mb-1",children:"No schemas found"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Try adjusting your filters"})]})}),e.jsx(re,{currentPage:b,totalPages:z,onPageChange:l})]}),e.jsx("div",{className:"flex-1 bg-white border border-gray-200 rounded-lg overflow-hidden",children:p?e.jsx(J,{message:p,availableVersions:U,selectedVersion:y,onVersionChange:H,apiAccessEnabled:c}):e.jsx("div",{className:"h-full flex items-center justify-center text-gray-500",children:e.jsxs("div",{className:"text-center",children:[e.jsx(ee,{className:"h-12 w-12 mx-auto mb-3 text-gray-400"}),e.jsx("p",{children:"Select a schema to view details"})]})})})]})})}export{Ce as default};
