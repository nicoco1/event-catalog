import{j as s}from"./jsx-runtime.DCqPeNwG.js";import{r as d}from"./index.66AI1_x2.js";import"./_commonjsHelpers.Cpj98o6Y.js";function j(e){return typeof e=="string"?e:Array.isArray(e)?e.map(t=>j(t)).join(" | "):typeof e=="object"?e.type==="array"?`array<${j(e.items)}>`:e.type==="map"?`map<${j(e.values)}>`:e.type==="record"?`record: ${e.name||"unnamed"}`:e.type==="enum"?`enum: ${e.name||"unnamed"}`:e.logicalType?`${e.type} (${e.logicalType})`:e.type||"unknown":"unknown"}function K(e){return typeof e=="object"&&!Array.isArray(e)?e.type==="record"&&e.fields&&e.fields.length>0:Array.isArray(e)?e.some(t=>typeof t=="object"&&!Array.isArray(t)&&t.type==="record"&&t.fields&&t.fields.length>0):!1}function P(e){if("default"in e)return!1;const t=e.type;return t==="null"?!1:Array.isArray(t)?!t.includes("null"):!0}function Q(e){return Array.isArray(e)?e.find(t=>typeof t=="object"&&!Array.isArray(t)&&t.type==="record"):null}const S=({field:e,level:t,expand:o,showRequired:u})=>{const[x,h]=d.useState(o),p=K(e.type),b=`pl-${t*4}`,N=u?P(e):void 0,y=typeof e.type=="object"&&e.type.type==="record"?e.type:Q(e.type);return d.useEffect(()=>{h(o)},[o]),s.jsx("div",{className:`avro-field-container mb-2 border-l border-gray-200 ${b}`,children:s.jsxs("div",{className:"flex space-x-2",children:[s.jsx("div",{className:"flex-shrink-0 w-4 pt-0.5",children:p?s.jsx("button",{onClick:()=>h(!x),className:"avro-field-toggle text-gray-500 hover:text-gray-700 w-4 text-center","aria-expanded":x,children:s.jsx("span",{className:"font-mono text-xs",children:x?"▼":"▶"})}):null}),s.jsxs("div",{className:"flex-grow min-w-0",children:[s.jsxs("div",{className:"flex flex-wrap items-baseline gap-x-1.5 gap-y-1",children:[s.jsx("span",{className:"avro-field-name font-semibold text-gray-800 text-sm",children:e.name}),s.jsx("span",{className:"text-purple-600 font-mono text-xs",children:j(e.type)}),u&&N&&s.jsx("span",{className:"text-red-600 text-xs ml-auto flex-shrink-0",children:"required"})]}),e.doc&&s.jsx("p",{className:"text-gray-600 text-xs mt-1",children:e.doc}),e.type?.type==="enum"&&e.type.symbols&&s.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:["Values:"," ",e.type.symbols.map(n=>s.jsx("code",{className:"bg-gray-100 px-1 rounded mx-0.5",children:n},n))]}),p&&y&&s.jsx("div",{className:`avro-nested-content mt-2 ${x?"":"hidden"}`,children:y.fields.map(n=>s.jsx(S,{field:n,level:t+1,expand:o,showRequired:u},n.name))})]})]})})};function J({schema:e,title:t,maxHeight:o,expand:u=!1,search:x=!0,showRequired:h=!1,onOpenFullscreen:p}){const b=u===!0||u==="true",N=x!==!1&&x!=="false",y=h===!0||h==="true",[n,R]=d.useState(""),[T,k]=d.useState(b),[a,C]=d.useState([]),[l,g]=d.useState(-1),B=d.useRef(null),v=d.useRef(null),A=e?.fields?.length||0;d.useEffect(()=>{if(!v.current)return;const r=v.current.querySelectorAll(".avro-field-container"),f=[];if(n===""){r.forEach(c=>{c.classList.remove("search-match","search-no-match","search-current-match","search-dimmed");const i=c.querySelector(".avro-field-name");i&&(i.innerHTML=i.textContent||"")}),C([]),g(-1);return}const $=n.toLowerCase().trim();r.forEach(c=>{const i=c.querySelector(".avro-field-name");if(!i)return;if((i.textContent||"").toLowerCase().includes($)){c.classList.add("search-match"),c.classList.remove("search-dimmed"),f.push(c);const D=new RegExp(`(${$})`,"gi");i.innerHTML=(i.textContent||"").replace(D,'<mark class="bg-yellow-200 rounded px-0.5">$1</mark>');let m=c.parentElement;for(;m&&m!==v.current;){if(m.classList.contains("avro-nested-content")&&m.classList.contains("hidden")){const M=m.closest(".avro-field-container");if(M){const w=M.querySelector(".avro-field-toggle");w&&w.getAttribute("aria-expanded")==="false"&&w.click()}}m.classList.contains("avro-field-container")&&m.classList.remove("search-dimmed"),m=m.parentElement}}else c.classList.remove("search-match","search-current-match"),c.classList.add("search-dimmed"),i.innerHTML=i.textContent||""}),C(f),f.length>0?(g(0),f[0].scrollIntoView({behavior:"smooth",block:"center"})):g(-1)},[n]),d.useEffect(()=>{a.forEach((r,f)=>{f===l?r.classList.add("search-current-match"):r.classList.remove("search-current-match")}),l>=0&&a[l]&&a[l].scrollIntoView({behavior:"smooth",block:"center"})},[l,a]);const q=()=>{k(!0)},I=()=>{k(!1)},L=()=>{l>0&&g(l-1)},E=()=>{l<a.length-1&&g(l+1)};if(!e||e.type!=="record")return s.jsx("div",{className:"flex items-center justify-center p-8 text-gray-500",children:s.jsx("p",{className:"text-sm",children:"Invalid Avro schema format"})});const V=o?{maxHeight:o.includes("px")?o:`${o}px`,minHeight:"15em"}:{},F=o?"":"h-full",W=o?"overflow-hidden":"";return s.jsxs("div",{className:`${F} ${W} flex flex-col bg-white border border-gray-100 rounded-md shadow-sm`,style:V,children:[N&&s.jsxs("div",{className:"flex-shrink-0 bg-white pt-4 px-4 pb-3 border-b border-gray-100 shadow-sm",children:[s.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[s.jsxs("div",{className:"flex-1 relative",children:[s.jsx("input",{ref:B,type:"text",value:n,onChange:r=>R(r.target.value),placeholder:"Search fields...",className:"w-full px-3 py-1.5 pr-20 text-sm border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",onKeyDown:r=>{r.key==="Enter"&&(r.preventDefault(),r.shiftKey?L():E())}}),s.jsxs("div",{className:"absolute right-2 top-1/2 transform -translate-y-1/2 flex items-center gap-1",children:[s.jsx("button",{onClick:L,disabled:a.length===0||l<=0,className:"p-1 text-gray-400 hover:text-gray-600 disabled:opacity-30 disabled:cursor-not-allowed",title:"Previous match",children:s.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M15 19l-7-7 7-7"})})}),s.jsx("button",{onClick:E,disabled:a.length===0||l>=a.length-1,className:"p-1 text-gray-400 hover:text-gray-600 disabled:opacity-30 disabled:cursor-not-allowed",title:"Next match",children:s.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M9 5l7 7-7 7"})})})]})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[p&&s.jsx("button",{onClick:p,className:"px-3 py-1.5 text-xs font-medium text-gray-700 bg-gray-100 rounded-md hover:bg-gray-200 focus:outline-none focus:ring-2 focus:ring-gray-500",title:"Open in fullscreen",children:s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3.5 w-3.5 inline-block",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4"})})}),s.jsx("button",{onClick:q,className:"px-3 py-1.5 text-xs font-medium text-gray-700 bg-gray-100 rounded-md hover:bg-gray-200 focus:outline-none focus:ring-2 focus:ring-gray-500",children:"Expand All"}),s.jsx("button",{onClick:I,className:"px-3 py-1.5 text-xs font-medium text-gray-700 bg-gray-100 rounded-md hover:bg-gray-200 focus:outline-none focus:ring-2 focus:ring-gray-500",children:"Collapse All"}),s.jsxs("div",{className:"text-xs text-gray-500",children:[A," ",A===1?"field":"fields"]})]})]}),n&&s.jsx("div",{className:"mt-2 text-xs text-gray-600",children:a.length>0?`${l+1} of ${a.length} ${a.length===1?"match":"matches"}`:"No fields found"})]}),s.jsxs("div",{className:"px-4 pt-4",children:[s.jsxs("div",{className:"flex items-baseline gap-2 mb-2",children:[s.jsx("span",{className:"text-sm font-medium text-gray-600",children:"Record:"}),s.jsx("span",{className:"font-mono text-sm text-blue-600",children:e.name}),e.namespace&&s.jsxs("span",{className:"font-mono text-xs text-gray-500",children:["(",e.namespace,")"]})]}),e.doc&&s.jsx("p",{className:"text-gray-600 text-xs mb-4",children:e.doc})]}),s.jsxs("div",{ref:v,className:"flex-1 px-4 pb-4 overflow-auto",children:[e.fields&&e.fields.length>0?e.fields.map(r=>s.jsx(S,{field:r,level:0,expand:T,showRequired:y},r.name)):s.jsx("div",{className:"text-center py-8 text-gray-400",children:s.jsx("p",{className:"text-sm",children:"No fields defined"})}),n&&a.length===0&&s.jsx("div",{className:"text-center py-8",children:s.jsxs("div",{className:"text-gray-400 text-sm",children:[s.jsx("svg",{className:"mx-auto h-12 w-12 mb-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})}),s.jsx("p",{children:"No fields match your search"}),s.jsx("p",{className:"text-xs mt-1",children:"Try a different search term or clear the search to see all fields"})]})})]}),s.jsx("style",{children:`
        .search-dimmed {
          opacity: 0.4;
          transition: opacity 0.2s ease;
        }

        .search-match {
          opacity: 1;
          transition: opacity 0.2s ease;
        }

        .search-current-match {
          background-color: rgba(59, 130, 246, 0.1);
          border-left: 3px solid #3b82f6;
          padding-left: 8px;
          margin-left: -11px;
          transition: all 0.2s ease;
        }
      `})]})}export{J as default};
