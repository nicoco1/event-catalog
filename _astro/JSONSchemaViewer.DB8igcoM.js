import{j as e}from"./jsx-runtime.DCqPeNwG.js";import{r as p}from"./index.66AI1_x2.js";import"./_commonjsHelpers.Cpj98o6Y.js";function O(s){if(!s||typeof s!="object")return 0;let t=0;return s.properties&&(t+=Object.keys(s.properties).length,Object.values(s.properties).forEach(n=>{t+=O(n)})),s.items&&(t+=O(s.items)),s._isRootArrayItem&&s._rootArraySchema?.items,t}function H(s){const{processSchema:t,...n}=s;if(!n.allOf)return n;const r={type:n.type||"object",properties:{},required:[],description:n.description};return Object.keys(n).forEach(o=>{o!=="allOf"&&o!=="properties"&&o!=="required"&&o!=="description"&&(r[o]=n[o])}),n.properties&&(r.properties={...n.properties}),n.required&&(r.required=[...n.required]),n.allOf.forEach(o=>{const i=t?t(o):o;i.properties&&(r.properties={...r.properties,...i.properties}),i.required&&(r.required=[...new Set([...r.required,...i.required])]),i.description&&!r.description&&(r.description=i.description),Object.keys(i).forEach(c=>{c!=="properties"&&c!=="required"&&c!=="description"&&c!=="type"&&(r[c]||(r[c]=i[c]))})}),r}function j(s,t){if(!s)return s;const n=t||s;if(s.$ref){const r=s.$ref;let o=null,i="";return r.startsWith("#/definitions/")?(i=r.replace("#/definitions/",""),n.definitions&&n.definitions[i]&&(o=n.definitions[i])):r.startsWith("#/$defs/")?(i=r.replace("#/$defs/",""),n.$defs&&n.$defs[i]&&(o=n.$defs[i])):r.startsWith("#/components/schemas/")&&(i=r.replace("#/components/schemas/",""),n.components&&n.components.schemas&&n.components.schemas[i]&&(o=n.components.schemas[i])),o?{...j(o,n),_refPath:r,_refName:i,_originalRef:s.$ref}:{type:"string",description:`Reference to ${r} (definition not found in root schema)`,title:i||r.split("/").pop(),_refPath:r,_refName:i,_refNotFound:!0}}if(s.allOf)return H({...s,processSchema:r=>j(r,n)});if(s.oneOf){const r=s.oneOf.map(i=>{const c=j(i,n);return{title:c.title||i.title||"Unnamed Variant",required:c.required||i.required||[],properties:c.properties||{},...c}}),o={};return r.forEach(i=>{i.properties&&Object.assign(o,i.properties)}),{...s,type:s.type||"object",properties:{...s.properties||{},...o},variants:r}}if(s.properties){const r={};Object.entries(s.properties).forEach(([o,i])=>{r[o]=j(i,n)}),s={...s,properties:r}}return s.type==="array"&&s.items&&(s={...s,items:j(s.items,n)}),s}const M=({name:s,details:t,isRequired:n,level:r,isListItem:o=!1,expand:i})=>{const[c,N]=p.useState(i),w=p.useRef(`prop-${s}-${r}-${Math.random().toString(36).substring(2,7)}`).current;p.useEffect(()=>{N(i)},[i]);const f=t.type==="object"&&t.properties&&Object.keys(t.properties).length>0,S=t.type==="array"&&t.items,k=S&&(t.items.type==="object"&&t.items.properties||t.items.allOf||t.items.oneOf||t.items.$ref),b=f||k,C=`pl-${r*3}`;return e.jsx("div",{className:`property-container mb-1.5 border-l border-gray-100 relative ${C}`,children:e.jsxs("div",{className:"flex items-start space-x-1.5",children:[b?e.jsxs("button",{type:"button","aria-expanded":c,"aria-controls":w,onClick:()=>N(!c),className:"property-toggle text-gray-500 hover:text-gray-700 pt-0.5 focus:outline-none w-3 text-center flex-shrink-0",children:[e.jsx("span",{className:`icon-collapsed font-mono text-xs ${c?"hidden":""}`,children:">"}),e.jsx("span",{className:`icon-expanded font-mono text-xs ${c?"":"hidden"}`,children:"v"})]}):e.jsx("div",{className:"w-3 h-4 flex-shrink-0"}),e.jsxs("div",{className:"flex-grow",children:[e.jsxs("div",{className:"flex justify-between items-baseline",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold text-gray-800 text-sm",children:s}),e.jsxs("span",{className:"ml-1.5 text-purple-600 font-mono text-xs",children:[t.type,t.type==="array"&&t.items?.type?`[${t.items.type}]`:"",t.format?`<${t.format}>`:"",t._refPath&&e.jsxs("span",{className:"text-blue-600 ml-1",children:["→ ",t._refName||t._refPath]}),t._refNotFound&&e.jsx("span",{className:"text-red-600 ml-1",children:"❌ ref not found"}),t.const!==void 0&&e.jsxs("span",{children:["constant: ",e.jsx("code",{children:t.const})]})]})]}),n&&e.jsx("span",{className:"text-red-600 text-xs ml-3 flex-shrink-0",children:"required"})]}),t.description&&e.jsx("p",{className:"text-gray-500 text-xs mt-0.5",children:t.description}),t.title&&t.title!==t.description&&e.jsxs("p",{className:"text-gray-500 text-xs mt-0.5 italic",children:["Title: ",t.title]}),e.jsxs("div",{className:"text-xs text-gray-500 mt-0.5 space-y-0",children:[t.pattern&&e.jsxs("div",{children:["Match pattern: ",e.jsx("code",{className:"bg-gray-100 px-1 rounded text-gray-800 font-thin py-0.5",children:t.pattern})]}),t.minimum!==void 0&&e.jsxs("div",{children:["Minimum: ",e.jsx("code",{className:"bg-gray-100 px-1 rounded text-gray-800 font-thin py-0.5",children:t.minimum})]}),t.maximum!==void 0&&e.jsxs("div",{children:["Maximum: ",e.jsx("code",{className:"bg-gray-100 px-1 rounded text-gray-800 font-thin py-0.5",children:t.maximum})]}),t.minLength!==void 0&&e.jsxs("div",{children:["Min length: ",e.jsx("code",{className:"bg-gray-100 px-1 rounded text-gray-800 font-thin py-0.5",children:t.minLength})]}),t.maxLength!==void 0&&e.jsxs("div",{children:["Max length: ",e.jsx("code",{className:"bg-gray-100 px-1 rounded text-gray-800 font-thin py-0.5",children:t.maxLength})]}),t.enum&&e.jsxs("div",{children:[e.jsx("span",{className:"text-xs inline-block",children:"Allowed values:"}),t.enum.map((h,d)=>e.jsxs("span",{className:"text-xs",children:[" ",e.jsx("code",{className:"bg-gray-100 px-1 rounded text-gray-800 font-thin py-0.5",children:h})]},d))]})]}),(f||S)&&e.jsxs("div",{id:w,className:`nested-content mt-1 ${b&&!c?"hidden":""}`,children:[f&&t.properties&&Object.entries(t.properties).map(([h,d])=>e.jsx(M,{name:h,details:d,isRequired:t.required?.includes(h)??!1,level:r+1,expand:i},h)),k&&e.jsxs("div",{className:"mt-1 border-l border-dashed border-gray-400 pl-3 ml-1.5",children:[e.jsx("span",{className:"text-xs italic text-gray-500 block mb-1",children:"Item Details:"}),t.items.properties&&Object.entries(t.items.properties).map(([h,d])=>e.jsx(M,{name:h,details:d,isRequired:t.items.required?.includes(h)??!1,level:r+1,isListItem:!0,expand:i},h)),(t.items.allOf||t.items.oneOf||t.items.$ref)&&!t.items.properties&&e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:"Complex array item schema detected. The properties should be processed by the parent SchemaViewer."})]})]})]})]})})};function te({schema:s,title:t,maxHeight:n,expand:r=!1,search:o=!0,id:i,onOpenFullscreen:c}){const N=r===!0||r==="true",w=o!==!1&&o!=="false",[f,S]=p.useState(""),[k,b]=p.useState(N),[C,h]=p.useState(0),[d,A]=p.useState([]),[x,v]=p.useState(-1),D=p.useRef(null),L=p.useRef(null),l=p.useMemo(()=>j(s),[s]),{displaySchema:q,isRootArray:I}=p.useMemo(()=>{let a=l,m=!1;return l.type==="array"&&l.items&&(m=!0,l.items.type==="object"&&l.items.properties?a={...l.items,description:l.description||l.items.description,_isRootArrayItem:!0,_rootArraySchema:l}:(l.items.allOf||l.items.oneOf||l.items.$ref)&&(a={...j(l.items),description:l.description||l.items.description,_isRootArrayItem:!0,_rootArraySchema:l})),{displaySchema:a,isRootArray:m}},[l]),{description:R,properties:_,required:J=[],variants:$}=q,P=p.useMemo(()=>O(q),[q]);p.useEffect(()=>{if(!L.current)return;const a=L.current.querySelectorAll(".property-container"),m=[];if(f===""){a.forEach(u=>{u.classList.remove("search-match","search-no-match","search-current-match","search-dimmed");const y=u.querySelector(".font-semibold");y&&(y.innerHTML=y.textContent||"")}),A([]),v(-1);return}const B=f.toLowerCase().trim();a.forEach(u=>{const y=u.querySelector(".font-semibold");if(!y)return;if((y.textContent||"").toLowerCase().includes(B)){u.classList.add("search-match"),u.classList.remove("search-dimmed"),m.push(u);const G=new RegExp(`(${B})`,"gi");y.innerHTML=(y.textContent||"").replace(G,'<mark class="bg-yellow-200 rounded px-0.5">$1</mark>');let g=u.parentElement;for(;g&&g!==L.current;){if(g.classList.contains("nested-content")&&g.classList.contains("hidden")){const W=g.closest(".property-container");if(W){const E=W.querySelector(".property-toggle");E&&E.getAttribute("aria-expanded")==="false"&&E.click()}}g.classList.contains("property-container")&&g.classList.remove("search-dimmed"),g=g.parentElement}}else u.classList.remove("search-match","search-current-match"),u.classList.add("search-dimmed"),y.innerHTML=y.textContent||""}),A(m),m.length>0?(v(0),m[0].scrollIntoView({behavior:"smooth",block:"center"})):v(-1)},[f]),p.useEffect(()=>{d.forEach((a,m)=>{m===x?a.classList.add("search-current-match"):a.classList.remove("search-current-match")}),x>=0&&d[x]&&d[x].scrollIntoView({behavior:"smooth",block:"center"})},[x,d]);const K=()=>{b(!0)},Q=()=>{b(!1)},V=()=>{x>0&&v(x-1)},T=()=>{x<d.length-1&&v(x+1)};if(!s)return e.jsx("div",{className:"flex items-center justify-center h-full text-gray-500 p-8",children:e.jsx("p",{className:"text-sm",children:"Unable to parse JSON schema"})});const U=n?{maxHeight:n.includes("px")?n:`${n}px`,minHeight:"15em"}:{},z=n?"":"h-full",F=n?"overflow-hidden":"";return e.jsxs("div",{id:i,className:`${z} ${F} flex flex-col bg-white border border-gray-100 rounded-md shadow-sm`,style:U,children:[w&&e.jsxs("div",{className:"flex-shrink-0 bg-white pt-4 px-4 mb-4 pb-3 border-b border-gray-100 shadow-sm",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx("input",{ref:D,type:"text",value:f,onChange:a=>S(a.target.value),placeholder:"Search properties...",className:"w-full px-3 py-1.5 pr-20 text-sm border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",onKeyDown:a=>{a.key==="Enter"&&(a.preventDefault(),a.shiftKey?V():T())}}),e.jsxs("div",{className:"absolute right-2 top-1/2 transform -translate-y-1/2 flex items-center gap-1",children:[e.jsx("button",{onClick:V,disabled:d.length===0||x<=0,className:"p-1 text-gray-400 hover:text-gray-600 disabled:opacity-30 disabled:cursor-not-allowed",title:"Previous match",children:e.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M15 19l-7-7 7-7"})})}),e.jsx("button",{onClick:T,disabled:d.length===0||x>=d.length-1,className:"p-1 text-gray-400 hover:text-gray-600 disabled:opacity-30 disabled:cursor-not-allowed",title:"Next match",children:e.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M9 5l7 7-7 7"})})})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[c&&e.jsx("button",{onClick:c,className:"px-3 py-1.5 text-xs font-medium text-gray-700 bg-gray-100 rounded-md hover:bg-gray-200 focus:outline-none focus:ring-2 focus:ring-gray-500",title:"Open in fullscreen",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3.5 w-3.5 inline-block",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4"})})}),e.jsx("button",{onClick:K,className:"px-3 py-1.5 text-xs font-medium text-gray-700 bg-gray-100 rounded-md hover:bg-gray-200 focus:outline-none focus:ring-2 focus:ring-gray-500",children:"Expand All"}),e.jsx("button",{onClick:Q,className:"px-3 py-1.5 text-xs font-medium text-gray-700 bg-gray-100 rounded-md hover:bg-gray-200 focus:outline-none focus:ring-2 focus:ring-gray-500",children:"Collapse All"}),e.jsxs("div",{className:"text-xs text-gray-500",children:[P," ",P===1?"property":"properties"]})]})]}),f&&e.jsx("div",{className:"mt-2 text-xs text-gray-600",children:d.length>0?`${x+1} of ${d.length} ${d.length===1?"match":"matches"}`:"No properties found"})]}),e.jsxs("div",{className:"flex-1 px-4 pb-4 overflow-auto",children:[I&&e.jsxs("div",{className:"mb-4 p-3 bg-blue-50 border border-blue-200 rounded-md",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-blue-600 font-medium text-sm",children:"Array Schema"}),e.jsx("span",{className:"text-blue-500 font-mono text-xs",children:"array[object]"})]}),e.jsx("p",{className:"text-blue-700 text-xs mt-1",children:"This schema defines an array of objects. Each item in the array has the properties shown below."})]}),R&&e.jsx("p",{className:"text-gray-600 text-xs mb-5",children:R}),$&&e.jsx("div",{className:"mb-4",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"(one of)"}),e.jsx("select",{value:C,onChange:a=>h(parseInt(a.target.value)),className:"form-select text-sm border-gray-300 rounded-md shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50",children:$.map((a,m)=>e.jsx("option",{value:m,children:a.title},m))})]})}),_?e.jsx("div",{ref:L,children:Object.entries(_).map(([a,m])=>e.jsx(M,{name:a,details:m,isRequired:$?$[C]?.required?.includes(a)||!1:J.includes(a),level:0,expand:k},a))}):I?e.jsx("div",{className:"text-center py-8",children:e.jsxs("div",{className:"text-gray-500 text-sm",children:[e.jsxs("p",{children:["This array contains items of type:"," ",e.jsx("span",{className:"font-mono text-blue-600",children:l.items?.type||"unknown"})]}),l.items?.description&&e.jsx("p",{className:"text-xs mt-2 text-gray-600",children:l.items.description})]})}):e.jsx("p",{className:"text-gray-500 text-sm",children:"Schema does not contain any properties."}),f&&d.length===0&&e.jsx("div",{className:"text-center py-8",children:e.jsxs("div",{className:"text-gray-400 text-sm",children:[e.jsx("svg",{className:"mx-auto h-12 w-12 mb-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})}),e.jsx("p",{children:"No properties match your search"}),e.jsx("p",{className:"text-xs mt-1",children:"Try a different search term or clear the search to see all properties"})]})})]}),e.jsx("style",{children:`
        .search-dimmed {
          opacity: 0.4;
          transition: opacity 0.2s ease;
        }

        .search-match {
          opacity: 1;
          transition: opacity 0.2s ease;
        }

        .search-current-match {
          background-color: rgba(59, 130, 246, 0.1);
          border-left: 3px solid #3b82f6;
          padding-left: 8px;
          margin-left: -11px;
          transition: all 0.2s ease;
        }
      `})]})}export{te as default};
