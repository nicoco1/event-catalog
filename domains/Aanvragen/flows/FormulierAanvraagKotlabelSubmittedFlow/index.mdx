---
id: NieuweAanvraagKotlabelSubmittedFlow
name: Nieuw aanvraag formulier ontvangen
version: 1.0.0
summary: Flow voor het ontvangen en verwerken van een ingediend kotlabel aanvraagformulier
steps:
  - id: "nieuw_aanvraag_formulier_ontvangen"
    title: Formulier ontvangen
    summary: FormulierenLoket meldt een nieuw kotlabel aanvraagformulier
    message:
      id: FormulierAanvraagKotlabelSubmittedEvent
      version: 1.0.0
    next_step:
      id: "integration_process_formulieren_loket"
      label: "Nieuw formulier ontvangen en verwerken"

  - id: "integration_process_formulieren_loket"
    title: Nieuw formulier ontvangen en verwerken
    service:
      id: "IntegrationProcesesFormulierenLoket"
      version: 1.0.0
    next_step:
      id: "registreer_aanvraag_command"
      label: Registreer aanvraag

  - id: "registreer_aanvraag_command"
    title: Registreer aanvraag command
    message: 
      id: RegistreerAanvraagKotlabelApiRequest
      version: 1.0.0
    next_step:
      id: "aanvragen_service_aanvraag_registreren"
      label: Nieuwe aanvraag registreren

  - id: "aanvragen_service_aanvraag_registreren"
    title: AanvragenService
    service:
      id: "AanvragenService"
      version: 1.0.0
    next_step:
      id: "nieuwe_aanvraag_geregistreerd"
      label: Nieuwe aanvraag geregistreerd

  - id: "nieuwe_aanvraag_geregistreerd"
    title: Nieuwe aanvraag geregistreerd
    message:
      id: NieuweAanvraagGeregistreerdEvent
      version: 1.0.0
    next_step:
      id: "aanvragen_service_bestemming_registreren"
      label: Bestemming registreren
  
  - id: "aanvragen_service_bestemming_registreren"
    title: AanvragenService
    service:
      id: "AanvragenService"
      version: 1.0.0
    next_step:
      id: "bestemming_geregistreerd"
      label: Bestemming geregistreerd

  - id: "bestemming_geregistreerd"
    title: Bestemming geregistreerd
    message:
      id: BestemmingVoorAanvraagGeregistreerdEvent
      version: 1.0.0
    next_step:
      id: "aanvraag_zichtbaar_voor_gemeente"
      label: Aanvraag zichtbaar voor gemeente

  - id: "aanvraag_zichtbaar_voor_gemeente"
    title:  Aanvraag zichtbaar voor gemeente
    actor: 
      name: "Gemeente Gebruiker"
      version: 1.0.0
---

### Flow of feature
<NodeGraph/>
 
## Flow description

Deze flow beschrijft de verwerking van een ingediend kotlabel aanvraagformulier vanaf ontvangst tot registratie en toekenning van een bestemming.

- **Trigger:** `FormulierAanvraagKotlabelSubmittedEvent` (gepubliceerd door `LoketWebhookService`)
- **Stap 1:** De `IntegrationProcessesFormulierenLoket` haalt het formulier op en registreert een nieuwe aanvraag dmv een `RegistreerAanvraagKotlabelApiRequest` command.
- **Stap 2:** Wanneer de aanvraag is aangemaakt in de `AanvragenService`, publiceert de `AanvragenService` `NieuweAanvraagGeregistreerdEvent`.
- **Stap 3:** De `AanvragenService` vangt het - door zichzelf gepubliceerde - event `NieuweAanvraagGeregistreerdEvent` op en registreert een bestemming voor de aanvraag.
- **Stap 4:** Zodra er een bestemming voor de aanvraag is geregistreerd publiceert de `AanvragenService` `BestemmingVoorAanvraagGeregistreerdEvent`.

## Linked artefacts

- Formulier event: [FormulierAanvraagKotlabelSubmittedEvent](services/LoketWebhookService/events/FormulierAanvraagKotlabelSubmittedEvent/index.mdx)
- Command: [RegistreerAanvraagKotlabelApiRequest](services/AanvragenService/commands/RegistreerAanvraagKotlabelApiRequest/index.mdx)
- Nieuwe aanvraag event: [NieuweAanvraagGeregistreerdEvent](services/AanvragenService/events/NieuweAanvraagGeregistreerdEvent/index.mdx)
- Bestemming event: [BestemmingVoorAanvraagGeregistreerdEvent](services/AanvragenService/events/BestemmingVoorAanvraagGeregistreerdEvent/index.mdx)